from collections import defaultdict

class Solution:
    def countTrapezoids(self, points: list[list[int]]) -> int:
        n = len(points)

        def cal_line(i, j):
            x1, y1 = points[i]
            x2, y2 = points[j]
            if x1 != x2:
                k = (y1 - y2) / (x1 - x2)
                b = (x2 * y1 - x1 * y2) / (x1 - x2)
            else:
                k = float('inf')
                b = x1
            return (k, b)
        edges = defaultdict(lambda: defaultdict(int))
        lines = defaultdict(set)
        for i in range(n - 1):
            for j in range(i + 1, n):
                k, b = cal_line(i, j)
                edges[k][b] += 1
                lines[(k, b)].add(i)
                lines[(k, b)].add(j)
        if len(edges) == 1:
            return 0
        ans = 0
        for k, bs in edges.items():
            vals = list(bs.values())
            m = len(vals)
            for i in range(m - 1):
                for j in range(i + 1, m):
                    ans += vals[i] * vals[j]
        def count_parallelograms(pts):
            cnt = defaultdict(int)
            m = len(pts)
            for i in range(m):
                x1, y1 = pts[i]
                for j in range(i + 1, m):
                    x2, y2 = pts[j]
                    cnt[(x1 + x2, y1 + y2)] += 1
            total = 0
            for c in cnt.values():
                if c >= 2:
                    total += c * (c - 1) // 2
            return total
        dup = count_parallelograms(points)
        for line_pts in lines.values():
            if len(line_pts) >= 4:
                pts_on_line = [points[i] for i in line_pts]
                dup -= count_parallelograms(pts_on_line)
        return ans - dup
